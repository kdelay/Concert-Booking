# 설계 목적

## 시퀀스 다이어그램
가독성을 위해 사용자가 접근하는 API 별로 시퀀스를 나누었고, 각 request, response 를 정의했다.<br>
API 에 접근하기 위해서는 대기열 검증을 진행해야 한다.<br>
시퀀스 다이어그램만 보고도 서비스가 어떤 흐름으로 흘러가는지 파악할 수 있어야 한다.<br>

## ERD 다이어그램
### 테이블 구조 및 관계도
크게 4가지로 분류한다.
- 사용자 - 대기열 토큰
- 콘서트 - 콘서트 날짜 - 콘서트 좌석
- 예약 - 결제
- 잔액 - 잔액 히스토리

대기열 토큰의 waiting_token_status(대기열 토큰 상태) 필드가 ACTIVATE(활성화) 상태일 때만 사용자가 대기열에 접근할 수 있다고 판단하고, 활성화인 상태에서만 API 에 접근할 수 있다.<br>
요구사항에 따라 콘서트 좌석에 대해 임시 배정 상태가 만료된 경우, 대기열 토큰도 만료시킨다.

확장성 있는 테이블 구조를 목적으로 콘서트 테이블을 적절하게 정규화를 진행했다.<br>
고려 사항은 콘서트 테이블의 데이터가 변경되면 연관되어 있는 콘서트 에약 테이블의 정보가 변경되기 때문에, 콘서트 이름 및 날짜 필드가 필요할 것으로 판단되어 반정규화를 진행했다.

잔액 충전 내역 조회를 위한 히스토리 테이블을 구분해서 설계하고, 잔액을 확인할 수 있다.<br>

## 패키지 구조
유연성을 보장하고 확장 가능한 패키지 구조를 가져가는 것이 목표이다.<br>
비즈니스 로직의 import 관심사보다 수행해야 할 기능에 집중하기 위해서 repository 를 추상화하여 비즈니스 로직이 DB 와 상호작용하는 부분을 모르게 한다.<br>
이전에 (클린 + 레이어드) 아키텍처를 처음 적용해보면서 레이어드를 기준으로 잡는 패키지 구조를 적용해 본 경험이 있기 때문에, 이번에는 MSA 환경에 유용한 패키지 구조를 도입해 보았다.<br>
도메인 별로 강한 응집도를 가진 패키지 구조가 되지 않기 위해 도메인 패키지를 상단으로 두었다.<br>

### TDD
테스트 코드의 중요성을 인지함으로써, 테스트 코드를 활용해 서비스 코드를 견고하게 만들고 안전하게 보호할 수 있다.<br>
```text
기능 개발 구조 - Unit Test

1. 기능 요구사항 분석
2. 실패 TC 에 대해 정의
3. 2번 TC 를 모두 만족시킬 수 있도록 구현
4. 기능의 책임을 분석
    - 너무 다양한 TC 가 필요하지 않았는지
    - 너무 많은 책임이 주어져 있지는 않은지 (응집도)
5. 리팩토링
    - 적절한 위상의 책임을 가지고 있도록
    - 충분히 원자적으로 테스트가 가능하도록
```